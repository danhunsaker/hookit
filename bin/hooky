#!/usr/bin/env ruby

HOOKS_DIR = "/opt/local/hooky"

hook = ARGV.shift

if not hook
  $stderr.puts "hook is required"
  exit 1
end

if not File.exists? "#{HOOKS_DIR}/hooks/#{hook}"
  $stderr.puts "hook: #{hook} does not exist"
end

# TODO: find a way to conditionally trigger this if dev only
lib = File.expand_path('../../lib', __FILE__)
$LOAD_PATH.unshift(lib) unless $LOAD_PATH.include?(lib)

require 'hooky'

include Hooky::Hook   # payload helpers
include Hooky::DSL    # awesome resource library

set :hook_root, HOOKS_DIR

# require hook libs
Dir.glob("#{HOOKS_DIR}/lib/*.rb").each do |file|
  require file
end

load "#{HOOKS_DIR}/hooks/#{hook}"
